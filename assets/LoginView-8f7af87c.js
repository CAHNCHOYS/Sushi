import{_ as q,c as E,x as R,y as A,z as D,r as l,A as M,a as w,o as a,b as r,d as t,w as i,T as m,e,u as o,F as P,i as j,g as c,f as z,B as G,t as k,h as B,E as F,n as $,j as J,p as W,k as H}from"./index-05e32c29.js";import{u as K}from"./useFormSchemas-0420e61d.js";const _=u=>(W("data-v-cb90950d"),u=u(),H(),u),Q={class:"fullscreen"},X={key:0,class:"message message_same-user"},Y=_(()=>e("div",{class:"message__body"}," Не удалось войти по ввденным данным. Пожалуйста, введите правильные данные! ",-1)),Z=[Y],ee={key:0,class:"message message_success"},se=_(()=>e("div",{class:"message__body"}," Авторизация прошла успешно! Вас переведут на главную страницу ! ",-1)),oe=[se],te={key:0,class:"message message_error"},ae={class:"message__body"},ne={key:0,class:"message message_error"},re={class:"message__body"},ie={class:"fullscreen__body"},ce={class:"fullscreen__content"},le={class:"fullscreen__form-body"},_e=_(()=>e("div",{class:"action-form__title"},"Логин",-1)),ue={class:"action-form__elements"},de={class:"action-form__element"},me={class:"action-form__input-body"},ve=_(()=>e("div",{class:"action-form__placeholder"},"Email",-1)),pe={class:"action-form__element"},fe={class:"action-form__input-body"},he=_(()=>e("div",{class:"action-form__placeholder"},"Пароль",-1)),ge={class:"action-form__input-wrapper"},ye={__name:"LoginView",setup(u){E({validateOnBlur:!0,validateOnChange:!0,validateOnInput:!0,validateOnModelUpdate:!0});const{fetchUserCartProducts:L}=R(),C=A(),I=D(),{isErr:v,loginSchema:T,toggleBlur:g,toggleFocus:y,invalidSubmit:x,isInvalidForm:V}=K(),p=l(!0);M(()=>I.query.redirect,()=>{p.value=!0,setTimeout(()=>p.value=!1,2500)},{immediate:!0});const f=l(!1),h=l(!1),d=l(!1),b=l("Произошла ошибка"),N=async n=>{d.value=!0;let s=await z("/api/login",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(n)});console.log(s),s.err?(console.log(s.err),b.value=s.err,v.value=!0,setTimeout(()=>v.value=!1,3e3)):s.noSuchUser?(f.value=!0,setTimeout(()=>f.value=!1,3e3)):s.token&&(G().addUserToStorage(s),h.value=!0,await L(),setTimeout(()=>{C.push("/"),h.value=!1},2e3)),d.value=!1},O=n=>{const s=n.target.closest(".action-form__element").querySelector("input");console.log(s),s.type==="password"?s.type="text":s.type="password"};return(n,s)=>{const S=w("LoadingGif"),U=w("RouterLink");return a(),r("div",Q,[t(m,{name:"message"},{default:i(()=>[f.value?(a(),r("div",X,Z)):c("",!0)]),_:1}),t(m,{name:"message"},{default:i(()=>[h.value?(a(),r("div",ee,oe)):c("",!0)]),_:1}),t(m,{name:"message"},{default:i(()=>[o(v)?(a(),r("div",te,[e("div",ae,k(b.value),1)])):c("",!0)]),_:1}),t(m,{name:"message"},{default:i(()=>[n.$route.query.isLoginRequired&&p.value?(a(),r("div",ne,[e("div",re," Для доступа к данной странице ("+k(n.$route.query.redirect)+") необходимо авторизироваться ! ",1)])):c("",!0)]),_:1}),e("div",ie,[e("div",ce,[e("div",le,[t(o(P),{onSubmit:N,onInvalidSubmit:o(x),"validation-schema":o(T)},{default:i(()=>[_e,e("div",ue,[e("div",de,[e("div",me,[ve,t(o(B),{class:"action-form__input",type:"text",name:"email",onFocus:o(y),onBlur:o(g)},null,8,["onFocus","onBlur"])]),t(o(F),{class:"action-form__error-msg",name:"email"})]),e("div",pe,[e("div",fe,[he,t(o(B),{class:"action-form__input",type:"password",name:"password",onFocus:o(y),onBlur:o(g)},null,8,["onFocus","onBlur"])]),e("div",{class:"action-form__show-pass",onClick:O}," Показать/скрыть пароль "),t(o(F),{class:"action-form__error-msg",name:"password"})]),e("div",ge,[d.value?c("",!0):(a(),r("button",{key:0,class:$(["action-form__btn",{err:o(V)}]),type:"submit"}," Войти ",2))])])]),_:1},8,["onInvalidSubmit","validation-schema"]),d.value?(a(),j(S,{key:0})):c("",!0)]),t(U,{class:"home-button",to:"/"},{default:i(()=>[J("На главную")]),_:1})])])])}}},we=q(ye,[["__scopeId","data-v-cb90950d"]]);export{we as default};

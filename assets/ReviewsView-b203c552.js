import{_ as A,o as s,c as n,e,t as S,O as M,Q as B,r as i,a as N,K as O,b as k,g as u,d as w,w as I,T as q,n as x,i as d,B as G,C as P,f as m,F as z,j as J,E as K,p as Q,l as H}from"./index-20580c92.js";const W={class:"review"},X={class:"review__body"},Y={class:"review__header"},Z={class:"review__user"},ee={class:"review__date"},se={class:"review__text"},te={__name:"ReviewItem",props:{review:{type:Object,required:!0}},setup(o){const t=o;return(a,_)=>(s(),n("div",W,[e("div",X,[e("div",Y,[e("div",Z,S(o.review.name),1),e("div",ee,S(new Date(t.review.date).toLocaleDateString()),1)]),e("div",se,S(o.review.text),1)])]))}},ae=A(te,[["__scopeId","data-v-2e0b29d7"]]),L="https://sushi-backend-henna.vercel.app";class oe{async getAllReviews(){let t=await fetch(`${L}/api/reviews`);if(!t.ok)throw new Error((await t.json()).err);return await t.json()}async addReview(t){let a=await fetch(`${L}/api/reviews`,{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw new Error((await a.json()).err);return await a.json()}}const T=new oe,re=o=>{const t=o.split(",")[0].split(".");return t[1]+"."+t[0]+"."+t[2]};const F=o=>(Q("data-v-15afb4cf"),o=o(),H(),o),ie={class:"reviews"},ne={key:1,class:"reviews__body"},le={key:0,class:"reviews__message reviews__message_added"},de={key:0,class:"reviews__header"},_e=F(()=>e("div",{class:"reviews__title"},"Отзывы",-1)),ce={class:"reviews__button"},ve={class:"reviews__add-form review-form"},ue={class:"review-form__elements"},we={class:"review-form__element"},me=F(()=>e("div",{class:"review-form__element-title"},"Ваше сообщение",-1)),fe={class:"review-form__textarea"},pe={class:"review-form__submit"},he=["disabled"],ge={key:0,class:"review-form__not-logged"},ye={key:2,class:"reviews__reviews"},be={class:"reviews__all-reviews"},Re={key:3,class:"reviews__no-reviews"},Se={__name:"ReviewsView",setup(o){const t=M({message:B().min(10,"Сообщение должно иметь больше символов!").required("Поле обязательное для ввода!")}),a=i(!1),_=i(!1),j=async(r,{resetForm:l})=>{if(f.isUserLoggedIn){let g=new Date().toLocaleString();await D({...r,currentDate:g}),l()}},C=()=>{_.value=!0,setTimeout(()=>_.value=!1,500)},f=N(),c=i([]),y=i(!1),p=i(!1),b=i(!1),R=i(!1),h=i(!1),$=i("Произошла ошибка"),E=i("Произошла ошибка"),D=async r=>{try{h.value=!0,r.user_id=f.currentUser.id,await T.addReview(r),c.value.push({text:r.message,date:re(r.currentDate),name:f.currentUser.name}),b.value=!0,setTimeout(()=>b.value=!1,2500)}catch(l){R.value=!0,setTimeout(()=>R.value=!1,2500),E.value=l.message}finally{h.value=!1}};return O(async()=>{try{y.value=!0;const r=await T.getAllReviews();c.value=r}catch(r){p.value=!0,$.value=r.message}finally{y.value=!1}}),(r,l)=>{const g=k("LoadingGif"),V=k("VErrorMessage"),U=k("slide-up-down");return s(),n("div",ie,[y.value?(s(),u(g,{key:0})):(s(),n("div",ne,[w(q,{name:"message"},{default:I(()=>[b.value?(s(),n("div",le," Отзыв добавлен! ")):d("",!0)]),_:1}),p.value?d("",!0):(s(),n("div",de,[_e,e("div",ce,[e("button",{class:x(["reviews__add-button",{red:a.value,"icon-plus":!a.value}]),onClick:l[0]||(l[0]=v=>a.value=!a.value)}," Добавить отзыв ",2)])])),w(U,{modelValue:a.value,"onUpdate:modelValue":l[1]||(l[1]=v=>a.value=v),duration:500},{default:I(()=>[e("div",ve,[h.value?(s(),u(g,{key:0,class:"reviews__loading-add"})):d("",!0),w(m(z),{onInvalidSubmit:C,onSubmit:j,class:x(["review-form__form",{opacity:h.value}]),"validation-schema":m(t)},{default:I(()=>[e("div",ue,[e("div",we,[me,e("div",fe,[w(m(J),{as:"textarea",name:"message",placeholder:"Сообщение"})]),w(m(K),{class:"review-form__error-msg",name:"message"})]),e("div",pe,[e("button",{type:"submit",class:x({err:_.value}),disabled:_.value}," Отправить отзыв ",10,he),m(f).isUserLoggedIn?d("",!0):(s(),n("div",ge," Для добавления отзыва необходимо войти в аккаунт "))])])]),_:1},8,["validation-schema","class"]),R.value?(s(),u(V,{key:1,"err-message":E.value,style:{"margin-bottom":"20px"}},null,8,["err-message"])):d("",!0)])]),_:1},8,["modelValue"]),p.value?(s(),u(V,{key:1,"err-message":$.value},null,8,["err-message"])):d("",!0),c.value.length?(s(),n("div",ye,[e("div",be,[(s(!0),n(G,null,P(c.value,v=>(s(),u(ae,{key:v.review_id,review:v},null,8,["review"]))),128))])])):!p.value&&!c.value.length?(s(),n("div",Re," Пока что отзывов нет, станьте первым! ")):d("",!0)]))])}}},Ie=A(Se,[["__scopeId","data-v-15afb4cf"]]);export{Ie as default};

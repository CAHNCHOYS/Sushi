import{_ as N,F as q,G as O,r as l,a as w,o as a,c as r,b as t,w as i,T as m,d as e,u as o,f as R,e as c,H as A,I as G,t as k,n as M,g as D,p as P,h as $}from"./index-e6c5bcf0.js";import{u as z}from"./useFormSchemas-a3ddd8f3.js";import{c as H,F as Q,a as F,E as L}from"./vee-validate.esm-adae6640.js";const _=u=>(P("data-v-4e59da4f"),u=u(),$(),u),W={class:"fullscreen"},j={key:0,class:"message message_same-user"},J=_(()=>e("div",{class:"message__body"}," Не удалось войти по ввденным данным. Пожалуйста, введите правильные данные! ",-1)),K=[J],X={key:0,class:"message message_success"},Y=_(()=>e("div",{class:"message__body"}," Авторизация прошла успешно! Вас переведут на главную страницу ! ",-1)),Z=[Y],ee={key:0,class:"message message_error"},se={class:"message__body"},oe={key:0,class:"message message_error"},te={class:"message__body"},ae={class:"fullscreen__body"},ne={class:"fullscreen__content"},re={class:"fullscreen__form-body"},ie=_(()=>e("div",{class:"action-form__title"},"Логин",-1)),ce={class:"action-form__elements"},le={class:"action-form__element"},_e={class:"action-form__input-body"},ue=_(()=>e("div",{class:"action-form__placeholder"},"Email",-1)),de={class:"action-form__element"},me={class:"action-form__input-body"},fe=_(()=>e("div",{class:"action-form__placeholder"},"Пароль",-1)),ve={class:"action-form__input-wrapper"},pe={__name:"LoginView",setup(u){const{fetchUserCartProducts:B}=q(),I=O();H({validateOnBlur:!0,validateOnChange:!0,validateOnInput:!0,validateOnModelUpdate:!0});const{isErr:f,loginSchema:C,toggleBlur:h,toggleFocus:y,invalidSubmit:T,isInvalidForm:U}=z(),S=l(!0);setTimeout(()=>S.value=!1,2500);const v=l(!1),p=l(!1),d=l(!1),g=l("Произошла ошибка"),V=async n=>{d.value=!0;let s=await A(n);console.log(s),s.err?(console.log(s.err),s.err.name?g.value="Произошла ошибка в запросе при авторизации!":g.value="Произошла ошибка на стороне сервера, возможно в SQL запросе на сервере",f.value=!0,setTimeout(()=>f.value=!1,3e3)):s.noSuchUser?(v.value=!0,setTimeout(()=>v.value=!1,3e3)):s.token&&(G().addUserToStorage(s),p.value=!0,await B(),setTimeout(()=>{I.push("/"),p.value=!1},2e3)),d.value=!1},x=n=>{const s=n.target.closest(".action-form__element").querySelector("input");console.log(s),s.type==="password"?s.type="text":s.type="password"};return(n,s)=>{const b=w("LoadingGif"),E=w("RouterLink");return a(),r("div",W,[t(m,{name:"message"},{default:i(()=>[v.value?(a(),r("div",j,K)):c("",!0)]),_:1}),t(m,{name:"message"},{default:i(()=>[p.value?(a(),r("div",X,Z)):c("",!0)]),_:1}),t(m,{name:"message"},{default:i(()=>[o(f)?(a(),r("div",ee,[e("div",se,k(g.value),1)])):c("",!0)]),_:1}),t(m,{name:"message"},{default:i(()=>[n.$route.query.isLoginRequired&&S.value?(a(),r("div",oe,[e("div",te," Для доступа к данной странице ("+k(n.$route.query.redirect)+") необходимо авторизироваться ! ",1)])):c("",!0)]),_:1}),e("div",ae,[e("div",ne,[e("div",re,[t(o(Q),{onSubmit:V,onInvalidSubmit:o(T),"validation-schema":o(C)},{default:i(()=>[ie,e("div",ce,[e("div",le,[e("div",_e,[ue,t(o(F),{class:"action-form__input",type:"text",name:"email",onFocus:o(y),onBlur:o(h)},null,8,["onFocus","onBlur"])]),t(o(L),{class:"action-form__error-msg",name:"email"})]),e("div",de,[e("div",me,[fe,t(o(F),{class:"action-form__input",type:"password",name:"password",onFocus:o(y),onBlur:o(h)},null,8,["onFocus","onBlur"])]),e("div",{class:"action-form__show-pass",onClick:x}," Показать/скрыть пароль "),t(o(L),{class:"action-form__error-msg",name:"password"})]),e("div",ve,[d.value?c("",!0):(a(),r("button",{key:0,class:M(["action-form__btn",{err:o(U)}]),type:"submit"}," Войти ",2))])])]),_:1},8,["onInvalidSubmit","validation-schema"]),d.value?(a(),R(b,{key:0})):c("",!0)]),t(E,{class:"home-button",to:"/"},{default:i(()=>[D("На главную")]),_:1})])])])}}},Se=N(pe,[["__scopeId","data-v-4e59da4f"]]);export{Se as default};

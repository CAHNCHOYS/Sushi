import{_ as D,o,c as l,d as s,t as L,I as O,r as n,s as B,a as x,u as t,f as y,b as m,w as S,T as E,n as F,e as w,S as j,V as N,K as T,L as $,p as q,h as G}from"./index-e6c5bcf0.js";import{c as z,b as J,d as K,F as P,a as H,E as Q}from"./vee-validate.esm-adae6640.js";const W={class:"review"},X={class:"review__body"},Y={class:"review__header"},Z={class:"review__user"},ee={class:"review__date"},se={class:"review__text"},te={__name:"ReviewItem",props:{review:{type:Object,required:!0}},setup(e){const a=e;return(_,c)=>(o(),l("div",W,[s("div",X,[s("div",Y,[s("div",Z,L(e.review.name),1),s("div",ee,L(new Date(a.review.date).toLocaleDateString()),1)]),s("div",se,L(e.review.text),1)])]))}},ae=D(te,[["__scopeId","data-v-8e4b84b4"]]),ie=async()=>{try{return await(await fetch("https://sushi-backend-henna.vercel.app/api/reviews")).json()}catch(e){return console.log(e),{err:e}}},oe=async e=>{try{return await(await fetch("https://sushi-backend-henna.vercel.app/api/reviews",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(e)})).json()}catch(a){return console.log(a),{err:a}}},re=()=>{const e=O(),a=n([]),_=n(!1),c=n(!1),g=n(!1),h=n(!1),f=n(!1),v=n(!1),p=n("Произошла ошибка"),k=async i=>{if(v.value=!0,e.checkIfUserLogged){i.user_id=e.currentUser.id;const r=await oe(i);if(r.err&&(console.log(r.err),f.value=!0,setTimeout(()=>f.value=!1,2500)),r.isAdded){const d=i.currentDate.split(",")[0].split("."),I=d[1]+"."+d[0]+"."+d[2];a.value.push({text:i.message,date:I,name:e.currentUser.name}),h.value=!0,setTimeout(()=>h.value=!1,2500)}}else g.value=!0,setTimeout(()=>g.value=!1,2500);v.value=!1};return B(async()=>{_.value=!0;const i=await ie();console.log(i),i.length&&(a.value=i),i.err&&(i.err.name?p.value="Ошибка в запросе при загрузке отзывов!":p.value="Ошибка на стороне сервера при загрузке отзывов",console.log(i.err),c.value=!0),_.value=!1}),{reviews:a,isFetchingLoading:_,isError:c,addReviewItem:k,isUserLogged:g,isReviewAdded:h,isAddError:f,errorMessage:p,isAddingLoading:v}};const U=e=>(q("data-v-dfbb143b"),e=e(),G(),e),ne={class:"reviews"},de={key:1,class:"reviews__body"},ce={class:"reviews__message reviews__message_added"},le={class:"reviews__message reviews__message_not-logged"},_e={key:0,class:"reviews__header"},ve=U(()=>s("div",{class:"reviews__title"},"Отзывы",-1)),ue={class:"reviews__button"},me={class:"reviews__add-form review-form"},we={class:"review-form__elements"},ge={class:"review-form__element"},he=U(()=>s("div",{class:"review-form__element-title"},"Ваше сообщение",-1)),fe={class:"review-form__textarea"},pe={class:"review-form__submit"},be=["disabled"],ye={key:3,class:"reviews__no-reviews"},Re={key:4,class:"reviews__reviews"},Se={class:"reviews__all-reviews"},ke={__name:"ReviewsView",setup(e){z({validateOnBlur:!0,validateOnChange:!0,validateOnInput:!0,validateOnModelUpdate:!0});const{isError:a,isFetchingLoading:_,reviews:c,isUserLogged:g,isReviewAdded:h,isAddError:f,isAddingLoading:v,loadReviewsErrorMessage:p,addReviewItem:k}=re(),i=J({message:K().min(10,"Сообщение должно иметь больше символов!").required("Поле обязательное для ввода!")}),r=n(!1),d=n(!1),I=async(V,{resetForm:u})=>{let R=new Date().toLocaleString();await k({...V,currentDate:R}),u()},C=()=>{d.value=!0,setTimeout(()=>d.value=!1,500)};return(V,u)=>{const R=x("LoadingGif"),M=x("slide-up-down"),A=x("VErrorMessage");return o(),l("div",ne,[t(_)?(o(),y(R,{key:0})):(o(),l("div",de,[m(E,{name:"review"},{default:S(()=>[T(s("div",ce," Отзыв добавлен! ",512),[[$,t(h)]])]),_:1}),m(E,{name:"review"},{default:S(()=>[T(s("div",le," Для добавления отзыва требуется войти в аккаунт! ",512),[[$,t(g)]])]),_:1}),t(a)?w("",!0):(o(),l("div",_e,[ve,s("div",ue,[s("button",{class:F(["reviews__add-button",{red:r.value,"icon-plus":!r.value}]),onClick:u[0]||(u[0]=b=>r.value=!r.value)}," Добавить отзыв ",2)])])),m(M,{modelValue:r.value,"onUpdate:modelValue":u[1]||(u[1]=b=>r.value=b),duration:500},{default:S(()=>[s("div",me,[t(v)?(o(),y(R,{key:0,class:"reviews__loading-form"})):w("",!0),m(t(P),{onInvalidSubmit:C,onSubmit:I,class:F(["review-form__form",{opacity:t(v)}]),"validation-schema":t(i)},{default:S(()=>[s("div",we,[s("div",ge,[he,s("div",fe,[m(t(H),{as:"textarea",name:"message",placeholder:"Сообщение"})]),m(t(Q),{class:"review-form__error-msg",name:"message"})]),s("div",pe,[s("button",{type:"submit",class:F({err:d.value}),disabled:d.value}," Отправить отзыв ",10,be)])])]),_:1},8,["validation-schema","class"])])]),_:1},8,["modelValue"]),t(f)?(o(),y(A,{key:1,"err-message":"Произошла ошибка при добавлении отзыва"})):w("",!0),t(a)?(o(),y(A,{key:2,"err-message":t(p)},null,8,["err-message"])):w("",!0),!t(a)&&!t(c).length?(o(),l("div",ye," Пока что отзывов нет, станьте первым! ")):w("",!0),t(c).length?(o(),l("div",Re,[s("div",Se,[(o(!0),l(j,null,N(t(c),b=>(o(),y(ae,{key:b.review_id,review:b},null,8,["review"]))),128))])])):w("",!0)]))])}}},xe=D(ke,[["__scopeId","data-v-dfbb143b"]]);export{xe as default};

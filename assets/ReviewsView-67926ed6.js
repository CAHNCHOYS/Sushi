import{_ as O,o as i,b as _,e as s,t as E,B as N,r,M as G,f as L,c as j,l as q,m as P,a as V,u as e,i as p,d as m,w as I,T as M,n as A,g as y,O as z,P as J,D as T,G as $,F as H,h as K,E as Q,p as W,k as X}from"./index-19896134.js";const Y={class:"review"},Z={class:"review__body"},ee={class:"review__header"},se={class:"review__user"},te={class:"review__date"},ae={class:"review__text"},ie={__name:"ReviewItem",props:{review:{type:Object,required:!0}},setup(a){const n=a;return(c,l)=>(i(),_("div",Y,[s("div",Z,[s("div",ee,[s("div",se,E(a.review.name),1),s("div",te,E(new Date(n.review.date).toLocaleDateString()),1)]),s("div",ae,E(a.review.text),1)])]))}},oe=O(ie,[["__scopeId","data-v-8e4b84b4"]]),re=()=>{const a=N(),n=r([]),c=r(!1),l=r(!1),w=r(!1),g=r(!1),f=r(!1),v=r(!1),b=r("Произошла ошибка"),S=r("Произошла ошибка"),R=async t=>{if(v.value=!0,a.checkIfUserLogged){t.user_id=a.currentUser.id;const o=await L("/api/reviews",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(t)});if(o.err&&(console.log(o.err),f.value=!0,setTimeout(()=>f.value=!1,2500),S.value=o.err),o.isAdded){const d=t.currentDate.split(",")[0].split("."),x=d[1]+"."+d[0]+"."+d[2];n.value.push({text:t.message,date:x,name:a.currentUser.name}),g.value=!0,setTimeout(()=>g.value=!1,2500)}}else w.value=!0,setTimeout(()=>w.value=!1,2500);v.value=!1};return G(async()=>{c.value=!0;const t=await L("/api/reviews");console.log(t),t.length&&(n.value=t),t.err&&(console.log(t.err),l.value=!0,b.value=t.err),c.value=!1}),{reviews:n,isFetchingLoading:c,isError:l,addReviewItem:R,isUserNotLogged:w,isReviewAdded:g,isAddError:f,errorMessage:b,isReviewAdding:v,addErrorMessage:S}};const U=a=>(W("data-v-3153127c"),a=a(),X(),a),ne={class:"reviews"},de={key:1,class:"reviews__body"},le={class:"reviews__message reviews__message_added"},_e={class:"reviews__message reviews__message_not-logged"},ce={key:0,class:"reviews__header"},ve=U(()=>s("div",{class:"reviews__title"},"Отзывы",-1)),ue={class:"reviews__button"},me={class:"reviews__add-form review-form"},we={class:"review-form__elements"},ge={class:"review-form__element"},fe=U(()=>s("div",{class:"review-form__element-title"},"Ваше сообщение",-1)),he={class:"review-form__textarea"},pe={class:"review-form__submit"},ye=["disabled"],be={key:3,class:"reviews__reviews"},Se={class:"reviews__all-reviews"},ke={key:4,class:"reviews__no-reviews"},Ie={__name:"ReviewsView",setup(a){j({validateOnBlur:!0,validateOnChange:!0,validateOnInput:!0,validateOnModelUpdate:!0});const{isError:n,isFetchingLoading:c,reviews:l,isUserNotLogged:w,isReviewAdded:g,isAddError:f,isReviewAdding:v,errorMessage:b,addErrorMessage:S,addReviewItem:R}=re(),t=q({message:P().min(10,"Сообщение должно иметь больше символов!").required("Поле обязательное для ввода!")}),o=r(!1),d=r(!1),x=async(D,{resetForm:u})=>{let k=new Date().toLocaleString();await R({...D,currentDate:k}),u()},C=()=>{d.value=!0,setTimeout(()=>d.value=!1,500)};return(D,u)=>{const k=V("LoadingGif"),B=V("slide-up-down"),F=V("VErrorMessage");return i(),_("div",ne,[e(c)?(i(),p(k,{key:0})):(i(),_("div",de,[m(M,{name:"review"},{default:I(()=>[T(s("div",le," Отзыв добавлен! ",512),[[$,e(g)]])]),_:1}),m(M,{name:"review"},{default:I(()=>[T(s("div",_e," Для добавления отзыва требуется войти в аккаунт! ",512),[[$,e(w)]])]),_:1}),e(n)?y("",!0):(i(),_("div",ce,[ve,s("div",ue,[s("button",{class:A(["reviews__add-button",{red:o.value,"icon-plus":!o.value}]),onClick:u[0]||(u[0]=h=>o.value=!o.value)}," Добавить отзыв ",2)])])),m(B,{modelValue:o.value,"onUpdate:modelValue":u[1]||(u[1]=h=>o.value=h),duration:500},{default:I(()=>[s("div",me,[e(v)?(i(),p(k,{key:0,class:"reviews__loading-form"})):y("",!0),m(e(H),{onInvalidSubmit:C,onSubmit:x,class:A(["review-form__form",{opacity:e(v)}]),"validation-schema":e(t)},{default:I(()=>[s("div",we,[s("div",ge,[fe,s("div",he,[m(e(K),{as:"textarea",name:"message",placeholder:"Сообщение"})]),m(e(Q),{class:"review-form__error-msg",name:"message"})]),s("div",pe,[s("button",{type:"submit",class:A({err:d.value}),disabled:d.value}," Отправить отзыв ",10,ye)])])]),_:1},8,["validation-schema","class"])])]),_:1},8,["modelValue"]),e(f)?(i(),p(F,{key:1,"err-message":e(S),style:{"margin-bottom":"20px"}},null,8,["err-message"])):y("",!0),e(n)?(i(),p(F,{key:2,"err-message":e(b)},null,8,["err-message"])):y("",!0),e(l).length?(i(),_("div",be,[s("div",Se,[(i(!0),_(z,null,J(e(l),h=>(i(),p(oe,{key:h.review_id,review:h},null,8,["review"]))),128))])])):!e(n)&&!e(l).length?(i(),_("div",ke," Пока что отзывов нет, станьте первым! ")):y("",!0)]))])}}},xe=O(Ie,[["__scopeId","data-v-3153127c"]]);export{xe as default};

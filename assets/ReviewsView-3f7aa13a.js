import{_ as C,o,b as _,e as s,t as L,z as N,r as i,K as q,f as D,c as j,l as z,m as G,a as R,u as e,i as y,d as m,w as I,T as M,n as V,g as w,N as J,O as K,B as T,C as $,F as P,h as H,E as Q,p as W,k as X}from"./index-cc6b1b0d.js";const Y={class:"review"},Z={class:"review__body"},ee={class:"review__header"},se={class:"review__user"},te={class:"review__date"},ae={class:"review__text"},re={__name:"ReviewItem",props:{review:{type:Object,required:!0}},setup(a){const n=a;return(c,l)=>(o(),_("div",Y,[s("div",Z,[s("div",ee,[s("div",se,L(a.review.name),1),s("div",te,L(new Date(n.review.date).toLocaleDateString()),1)]),s("div",ae,L(a.review.text),1)])]))}},oe=C(re,[["__scopeId","data-v-8e4b84b4"]]),ie=()=>{const a=N(),n=i([]),c=i(!1),l=i(!1),g=i(!1),f=i(!1),h=i(!1),v=i(!1),b=i("Произошла ошибка"),S=i("Произошла ошибка"),x=async t=>{if(v.value=!0,a.checkIfUserLogged){t.user_id=a.currentUser.id;const r=await D("/api/reviews",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(t)});if(r.err&&(console.log(r.err),h.value=!0,setTimeout(()=>h.value=!1,2500),S.value=r.err.sqlError||r.err.message),r.isAdded){const d=t.currentDate.split(",")[0].split("."),E=d[1]+"."+d[0]+"."+d[2];n.value.push({text:t.message,date:E,name:a.currentUser.name}),f.value=!0,setTimeout(()=>f.value=!1,2500)}}else g.value=!0,setTimeout(()=>g.value=!1,2500);v.value=!1};return q(async()=>{c.value=!0;const t=await D("/api/reviews");console.log(t),t.length&&(n.value=t),t.err&&(console.log(t.err),l.value=!0,b.value=t.err.sqlError||t.err.message),c.value=!1}),{reviews:n,isFetchingLoading:c,isError:l,addReviewItem:x,isUserLogged:g,isReviewAdded:f,isAddError:h,errorMessage:b,isAddingLoading:v,addErrorMessage:S}};const O=a=>(W("data-v-4ff33d81"),a=a(),X(),a),ne={class:"reviews"},de={key:1,class:"reviews__body"},le={class:"reviews__message reviews__message_added"},_e={class:"reviews__message reviews__message_not-logged"},ce={key:0,class:"reviews__header"},ve=O(()=>s("div",{class:"reviews__title"},"Отзывы",-1)),ue={class:"reviews__button"},me={class:"reviews__add-form review-form"},we={class:"review-form__elements"},ge={class:"review-form__element"},fe=O(()=>s("div",{class:"review-form__element-title"},"Ваше сообщение",-1)),he={class:"review-form__textarea"},pe={class:"review-form__submit"},ye=["disabled"],be={key:3,class:"reviews__no-reviews"},Se={key:4,class:"reviews__reviews"},ke={class:"reviews__all-reviews"},Ie={__name:"ReviewsView",setup(a){j({validateOnBlur:!0,validateOnChange:!0,validateOnInput:!0,validateOnModelUpdate:!0});const{isError:n,isFetchingLoading:c,reviews:l,isUserLogged:g,isReviewAdded:f,isAddError:h,isAddingLoading:v,errorMessage:b,addErrorMessage:S,addReviewItem:x}=ie(),t=z({message:G().min(10,"Сообщение должно иметь больше символов!").required("Поле обязательное для ввода!")}),r=i(!1),d=i(!1),E=async(A,{resetForm:u})=>{let k=new Date().toLocaleString();await x({...A,currentDate:k}),u()},U=()=>{d.value=!0,setTimeout(()=>d.value=!1,500)};return(A,u)=>{const k=R("LoadingGif"),B=R("slide-up-down"),F=R("VErrorMessage");return o(),_("div",ne,[e(c)?(o(),y(k,{key:0})):(o(),_("div",de,[m(M,{name:"review"},{default:I(()=>[T(s("div",le," Отзыв добавлен! ",512),[[$,e(f)]])]),_:1}),m(M,{name:"review"},{default:I(()=>[T(s("div",_e," Для добавления отзыва требуется войти в аккаунт! ",512),[[$,e(g)]])]),_:1}),e(n)?w("",!0):(o(),_("div",ce,[ve,s("div",ue,[s("button",{class:V(["reviews__add-button",{red:r.value,"icon-plus":!r.value}]),onClick:u[0]||(u[0]=p=>r.value=!r.value)}," Добавить отзыв ",2)])])),m(B,{modelValue:r.value,"onUpdate:modelValue":u[1]||(u[1]=p=>r.value=p),duration:500},{default:I(()=>[s("div",me,[e(v)?(o(),y(k,{key:0,class:"reviews__loading-form"})):w("",!0),m(e(P),{onInvalidSubmit:U,onSubmit:E,class:V(["review-form__form",{opacity:e(v)}]),"validation-schema":e(t)},{default:I(()=>[s("div",we,[s("div",ge,[fe,s("div",he,[m(e(H),{as:"textarea",name:"message",placeholder:"Сообщение"})]),m(e(Q),{class:"review-form__error-msg",name:"message"})]),s("div",pe,[s("button",{type:"submit",class:V({err:d.value}),disabled:d.value}," Отправить отзыв ",10,ye)])])]),_:1},8,["validation-schema","class"])])]),_:1},8,["modelValue"]),e(h)?(o(),y(F,{key:1,"err-message":e(S),style:{"margin-bottom":"20px"}},null,8,["err-message"])):w("",!0),e(n)?(o(),y(F,{key:2,"err-message":e(b)},null,8,["err-message"])):w("",!0),!e(n)&&!e(l).length?(o(),_("div",be," Пока что отзывов нет, станьте первым! ")):w("",!0),e(l).length?(o(),_("div",Se,[s("div",ke,[(o(!0),_(J,null,K(e(l),p=>(o(),y(oe,{key:p.review_id,review:p},null,8,["review"]))),128))])])):w("",!0)]))])}}},Ee=C(Ie,[["__scopeId","data-v-4ff33d81"]]);export{Ee as default};

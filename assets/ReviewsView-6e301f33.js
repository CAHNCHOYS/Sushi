import{_ as A,o as t,c as i,d as e,t as I,R as N,S as B,r,z as O,J as q,a as V,g as w,b as c,w as f,T,n as $,i as _,M as z,N as G,e as y,F as J,j as P,E as H,p as K,l as Q}from"./index-a3469fee.js";const W={class:"review"},X={class:"review__body"},Y={class:"review__header"},Z={class:"review__user"},ee={class:"review__date"},se={class:"review__text"},te={__name:"ReviewItem",props:{review:{type:Object,required:!0}},setup(a){const d=a;return(n,v)=>(t(),i("div",W,[e("div",X,[e("div",Y,[e("div",Z,I(a.review.name),1),e("div",ee,I(new Date(d.review.date).toLocaleDateString()),1)]),e("div",se,I(a.review.text),1)])]))}},ae=A(te,[["__scopeId","data-v-e02bd92a"]]),E="https://sushi-backend-henna.vercel.app",oe=async()=>{try{return await(await fetch(`${E}/api/reviews`)).json()}catch(a){return{err:a}}},re=async a=>{try{return await(await fetch(`${E}/api/reviews`,{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(a)})).json()}catch(d){return{err:d}}};const F=a=>(K("data-v-69b0574a"),a=a(),Q(),a),ie={class:"reviews"},ne={key:1,class:"reviews__body"},le={key:0,class:"reviews__message reviews__message_added"},de={key:0,class:"reviews__message reviews__message_not-logged"},_e={key:0,class:"reviews__header"},ce=F(()=>e("div",{class:"reviews__title"},"Отзывы",-1)),ve={class:"reviews__button"},ue={class:"reviews__add-form review-form"},me={class:"review-form__elements"},we={class:"review-form__element"},ge=F(()=>e("div",{class:"review-form__element-title"},"Ваше сообщение",-1)),pe={class:"review-form__textarea"},he={class:"review-form__submit"},fe=["disabled"],ye={key:2,class:"reviews__reviews"},be={class:"reviews__all-reviews"},Se={key:3,class:"reviews__no-reviews"},ke={__name:"ReviewsView",setup(a){const d=N({message:B().min(10,"Сообщение должно иметь больше символов!").required("Поле обязательное для ввода!")}),n=r(!1),v=r(!1),D=async(s,{resetForm:o})=>{let l=new Date().toLocaleString();await U({...s,currentDate:l}),o()},M=()=>{v.value=!0,setTimeout(()=>v.value=!1,500)},b=O(),u=r([]),S=r(!1),g=r(!1),k=r(!1),R=r(!1),x=r(!1),p=r(!1),j=r("Произошла ошибка"),L=r("Произошла ошибка"),U=async s=>{if(p.value=!0,b.checkIfUserLogged){s.user_id=b.currentUser.id;const o=await re(s);if(o.err&&(console.log(o.err),x.value=!0,setTimeout(()=>x.value=!1,2500),L.value=o.err),o.isAdded){const l=s.currentDate.split(",")[0].split("."),h=l[1]+"."+l[0]+"."+l[2];u.value.push({text:s.message,date:h,name:b.currentUser.name}),R.value=!0,setTimeout(()=>R.value=!1,2500)}}else k.value=!0,setTimeout(()=>k.value=!1,2500);p.value=!1};return q(async()=>{S.value=!0;const s=await oe();console.log(s),s.length&&(u.value=s),s.err&&(console.log(s.err),g.value=!0,j.value=s.err),S.value=!1}),(s,o)=>{const l=V("LoadingGif"),h=V("VErrorMessage"),C=V("slide-up-down");return t(),i("div",ie,[S.value?(t(),w(l,{key:0})):(t(),i("div",ne,[c(T,{name:"message"},{default:f(()=>[R.value?(t(),i("div",le," Отзыв добавлен! ")):_("",!0)]),_:1}),c(T,{name:"message"},{default:f(()=>[k.value?(t(),i("div",de," Для добавления отзыва требуется войти в аккаунт! ")):_("",!0)]),_:1}),g.value?_("",!0):(t(),i("div",_e,[ce,e("div",ve,[e("button",{class:$(["reviews__add-button",{red:n.value,"icon-plus":!n.value}]),onClick:o[0]||(o[0]=m=>n.value=!n.value)}," Добавить отзыв ",2)])])),c(C,{modelValue:n.value,"onUpdate:modelValue":o[1]||(o[1]=m=>n.value=m),duration:500},{default:f(()=>[e("div",ue,[p.value?(t(),w(l,{key:0,class:"reviews__loading-add"})):_("",!0),c(y(J),{onInvalidSubmit:M,onSubmit:D,class:$(["review-form__form",{opacity:p.value}]),"validation-schema":y(d)},{default:f(()=>[e("div",me,[e("div",we,[ge,e("div",pe,[c(y(P),{as:"textarea",name:"message",placeholder:"Сообщение"})]),c(y(H),{class:"review-form__error-msg",name:"message"})]),e("div",he,[e("button",{type:"submit",class:$({err:v.value}),disabled:v.value}," Отправить отзыв ",10,fe)])])]),_:1},8,["validation-schema","class"]),x.value?(t(),w(h,{key:1,"err-message":L.value,style:{"margin-bottom":"20px"}},null,8,["err-message"])):_("",!0)])]),_:1},8,["modelValue"]),g.value?(t(),w(h,{key:1,"err-message":j.value},null,8,["err-message"])):_("",!0),u.value.length?(t(),i("div",ye,[e("div",be,[(t(!0),i(z,null,G(u.value,m=>(t(),w(ae,{key:m.review_id,review:m},null,8,["review"]))),128))])])):!g.value&&!u.value.length?(t(),i("div",Se," Пока что отзывов нет, станьте первым! ")):_("",!0)]))])}}},xe=A(ke,[["__scopeId","data-v-69b0574a"]]);export{xe as default};

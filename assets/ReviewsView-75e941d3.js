import{_ as j,o as a,c as d,d as t,t as A,z as C,r as n,J as N,O as B,P as O,a as L,e,g as b,b as w,w as I,T as F,n as E,i as v,L as P,M as q,F as z,j as G,E as J,p as H,l as K}from"./index-bfef6200.js";const Q={class:"review"},W={class:"review__body"},X={class:"review__header"},Y={class:"review__user"},Z={class:"review__date"},ee={class:"review__text"},se={__name:"ReviewItem",props:{review:{type:Object,required:!0}},setup(s){const i=s;return(r,l)=>(a(),d("div",Q,[t("div",W,[t("div",X,[t("div",Y,A(s.review.name),1),t("div",Z,A(new Date(i.review.date).toLocaleDateString()),1)]),t("div",ee,A(s.review.text),1)])]))}},te=j(se,[["__scopeId","data-v-d4de8603"]]),M="https://sushi-backend-henna.vercel.app",ae=async()=>{try{return await(await fetch(`${M}/api/reviews`)).json()}catch(s){return{err:s}}},re=async s=>{try{return await(await fetch(`${M}/api/reviews`,{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(s)})).json()}catch(i){return{err:i}}},oe=()=>{const s=C(),i=n([]),r=n(!1),l=n(!1),g=n(!1),p=n(!1),_=n(!1),h=n(!1),u=n("Произошла ошибка"),k=n("Произошла ошибка"),S=async o=>{if(h.value=!0,s.checkIfUserLogged){o.user_id=s.currentUser.id;const c=await re();if(c.err&&(console.log(c.err),_.value=!0,setTimeout(()=>_.value=!1,2500),k.value=c.err),c.isAdded){const f=o.currentDate.split(",")[0].split("."),x=f[1]+"."+f[0]+"."+f[2];i.value.push({text:o.message,date:x,name:s.currentUser.name}),p.value=!0,setTimeout(()=>p.value=!1,2500)}}else g.value=!0,setTimeout(()=>g.value=!1,2500);h.value=!1};return N(async()=>{r.value=!0;const o=await ae();console.log(o),o.length&&(i.value=o),o.err&&(console.log(o.err),l.value=!0,u.value=o.err),r.value=!1}),{reviews:i,isFetchingLoading:r,isError:l,isUserNotLogged:g,isReviewAdded:p,isAddError:_,errorMessage:u,isReviewAdding:h,addErrorMessage:k,addReviewItem:S}};const T=s=>(H("data-v-99d41250"),s=s(),K(),s),ie={class:"reviews"},ne={key:1,class:"reviews__body"},de={key:0,class:"reviews__message reviews__message_added"},le={key:0,class:"reviews__message reviews__message_not-logged"},_e={key:0,class:"reviews__header"},ce=T(()=>t("div",{class:"reviews__title"},"Отзывы",-1)),ve={class:"reviews__button"},ue={class:"reviews__add-form review-form"},me={class:"review-form__elements"},we={class:"review-form__element"},ge=T(()=>t("div",{class:"review-form__element-title"},"Ваше сообщение",-1)),pe={class:"review-form__textarea"},he={class:"review-form__submit"},fe=["disabled"],ye={key:2,class:"reviews__reviews"},be={class:"reviews__all-reviews"},ke={key:3,class:"reviews__no-reviews"},Re={__name:"ReviewsView",setup(s){const i=B({message:O().min(10,"Сообщение должно иметь больше символов!").required("Поле обязательное для ввода!")}),r=n(!1),l=n(!1),g=async(V,{resetForm:m})=>{let R=new Date().toLocaleString();await U({...V,currentDate:R}),m()},p=()=>{l.value=!0,setTimeout(()=>l.value=!1,500)},{isError:_,isFetchingLoading:h,reviews:u,isUserNotLogged:k,isReviewAdded:S,isAddError:o,isReviewAdding:c,errorMessage:f,addErrorMessage:x,addReviewItem:U}=oe();return(V,m)=>{const R=L("LoadingGif"),$=L("VErrorMessage"),D=L("slide-up-down");return a(),d("div",ie,[e(h)?(a(),b(R,{key:0})):(a(),d("div",ne,[w(F,{name:"review"},{default:I(()=>[e(S)?(a(),d("div",de," Отзыв добавлен! ")):v("",!0)]),_:1}),w(F,{name:"review"},{default:I(()=>[e(k)?(a(),d("div",le," Для добавления отзыва требуется войти в аккаунт! ")):v("",!0)]),_:1}),e(_)?v("",!0):(a(),d("div",_e,[ce,t("div",ve,[t("button",{class:E(["reviews__add-button",{red:r.value,"icon-plus":!r.value}]),onClick:m[0]||(m[0]=y=>r.value=!r.value)}," Добавить отзыв ",2)])])),w(D,{modelValue:r.value,"onUpdate:modelValue":m[1]||(m[1]=y=>r.value=y),duration:500},{default:I(()=>[t("div",ue,[e(c)?(a(),b(R,{key:0,class:"reviews__loading-form"})):v("",!0),w(e(z),{onInvalidSubmit:p,onSubmit:g,class:E(["review-form__form",{opacity:e(c)}]),"validation-schema":e(i)},{default:I(()=>[t("div",me,[t("div",we,[ge,t("div",pe,[w(e(G),{as:"textarea",name:"message",placeholder:"Сообщение"})]),w(e(J),{class:"review-form__error-msg",name:"message"})]),t("div",he,[t("button",{type:"submit",class:E({err:l.value}),disabled:l.value}," Отправить отзыв ",10,fe)])])]),_:1},8,["validation-schema","class"]),e(o)?(a(),b($,{key:1,"err-message":e(x),style:{"margin-bottom":"20px"}},null,8,["err-message"])):v("",!0)])]),_:1},8,["modelValue"]),e(_)?(a(),b($,{key:1,"err-message":e(f)},null,8,["err-message"])):v("",!0),e(u).length?(a(),d("div",ye,[t("div",be,[(a(!0),d(P,null,q(e(u),y=>(a(),b(te,{key:y.review_id,review:y},null,8,["review"]))),128))])])):!e(_)&&!e(u).length?(a(),d("div",ke," Пока что отзывов нет, станьте первым! ")):v("",!0)]))])}}},Se=j(Re,[["__scopeId","data-v-99d41250"]]);export{Se as default};

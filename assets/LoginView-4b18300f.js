import{_ as x,D as E,E as O,r as p,a as V,o as n,c,b as t,w as u,T as v,d as e,u as s,F as N,e as r,G as U,n as q,p as A,g as G}from"./index-6584aca8.js";import{c as P,u as j,F as D,a as w,E as S}from"./vee-validate.esm-3a05442f.js";const i=d=>(A("data-v-e715ba22"),d=d(),G(),d),M={class:"fullscreen"},R={key:0,class:"message message_same-user"},z=i(()=>e("div",{class:"message__body"}," Не удалось войти по ввденным данным. Пожалуйста, введите правильные данные! ",-1)),J=[z],W={key:0,class:"message message_success"},$=i(()=>e("div",{class:"message__body"}," Авторизация прошла успешно! Вас переведут на главную страницу ! ",-1)),H=[$],K={key:0,class:"message message_error"},Q=i(()=>e("div",{class:"message__body"}," Ошибка при отправке запрос, возможно, база данных не доступна ( ",-1)),X=[Q],Y={key:0,class:"message message_error"},Z=i(()=>e("div",{class:"message__body"}," Для доступа к корзине необходимо авторизироваться ! ",-1)),ee=[Z],se={class:"fullscreen__body"},oe={class:"fullscreen__content"},te={class:"fullscreen__form-body"},ae=i(()=>e("div",{class:"action-form__title"},"Логин",-1)),ne={class:"action-form__elements"},ie={class:"action-form__element"},ce={class:"action-form__input-body"},re=i(()=>e("div",{class:"action-form__placeholder"},"Email",-1)),le={class:"action-form__element"},_e={class:"action-form__input-body"},ue=i(()=>e("div",{class:"action-form__placeholder"},"Пароль",-1)),de={class:"action-form__input-wrapper"},me={__name:"LoginView",setup(d){const{fetchUserCartProducts:k}=E(),F=O();P({validateOnBlur:!0,validateOnChange:!0,validateOnInput:!0,validateOnModelUpdate:!0});const{isErr:l,loginSchema:B,toggleBlur:g,toggleFocus:y,invalidSubmit:C,isInvalidForm:I}=j(),b=p(!0);setTimeout(()=>b.value=!1,2500);const f=p(!1),h=p(!1),m=p(!1),T=async _=>{m.value=!0;try{let o=await fetch("https://sushi-backend-henna.vercel.app/api/login",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(_)}),a=await o.json();console.log(a),o.status===409&&(f.value=!0,setTimeout(()=>f.value=!1,3e3)),a.err&&(console.log(a.err),l.value=!0,setTimeout(()=>l.value=!1,3e3)),a.token&&(U().addUserToStorage(a),h.value=!0,await k(),setTimeout(()=>{F.push("/"),h.value=!1},2e3))}catch(o){console.log(o),l.value=!0,setTimeout(()=>l.value=!1,3e3)}finally{m.value=!1}},L=_=>{const o=_.target.closest(".action-form__element").querySelector("input");console.log(o),o.type==="password"?o.type="text":o.type="password"};return(_,o)=>{const a=V("LoadingGif");return n(),c("div",M,[t(v,{name:"message"},{default:u(()=>[f.value?(n(),c("div",R,J)):r("",!0)]),_:1}),t(v,{name:"message"},{default:u(()=>[h.value?(n(),c("div",W,H)):r("",!0)]),_:1}),t(v,{name:"message"},{default:u(()=>[s(l)?(n(),c("div",K,X)):r("",!0)]),_:1}),t(v,{name:"message"},{default:u(()=>[_.$route.query.isLoginRequired&&b.value?(n(),c("div",Y,ee)):r("",!0)]),_:1}),e("div",se,[e("div",oe,[e("div",te,[t(s(D),{onSubmit:T,onInvalidSubmit:s(C),"validation-schema":s(B)},{default:u(()=>[ae,e("div",ne,[e("div",ie,[e("div",ce,[re,t(s(w),{class:"action-form__input",type:"text",name:"email",onFocus:s(y),onBlur:s(g)},null,8,["onFocus","onBlur"])]),t(s(S),{class:"action-form__error-msg",name:"email"})]),e("div",le,[e("div",_e,[ue,t(s(w),{class:"action-form__input",type:"password",name:"password",onFocus:s(y),onBlur:s(g)},null,8,["onFocus","onBlur"])]),e("div",{class:"action-form__show-pass",onClick:L}," Показать/скрыть пароль "),t(s(S),{class:"action-form__error-msg",name:"password"})]),e("div",de,[m.value?r("",!0):(n(),c("button",{key:0,class:q(["action-form__btn",{err:s(I)}]),type:"submit"}," Войти ",2))])])]),_:1},8,["onInvalidSubmit","validation-schema"]),m.value?(n(),N(a,{key:0})):r("",!0)])])])])}}},he=x(me,[["__scopeId","data-v-e715ba22"]]);export{he as default};

import{_ as U,x as q,y as E,c as M,r as l,a as w,o as a,b as i,d as t,w as r,T as m,e,u as o,F as R,i as A,g as c,f as D,z as P,t as k,h as F,E as B,n as j,j as z,p as G,k as $}from"./index-cc6b1b0d.js";import{u as J}from"./useFormSchemas-a8f20602.js";const _=u=>(G("data-v-80099f2a"),u=u(),$(),u),W={class:"fullscreen"},H={key:0,class:"message message_same-user"},K=_(()=>e("div",{class:"message__body"}," Не удалось войти по ввденным данным. Пожалуйста, введите правильные данные! ",-1)),Q=[K],X={key:0,class:"message message_success"},Y=_(()=>e("div",{class:"message__body"}," Авторизация прошла успешно! Вас переведут на главную страницу ! ",-1)),Z=[Y],ee={key:0,class:"message message_error"},se={class:"message__body"},oe={key:0,class:"message message_error"},te={class:"message__body"},ae={class:"fullscreen__body"},ne={class:"fullscreen__content"},ie={class:"fullscreen__form-body"},re=_(()=>e("div",{class:"action-form__title"},"Логин",-1)),ce={class:"action-form__elements"},le={class:"action-form__element"},_e={class:"action-form__input-body"},ue=_(()=>e("div",{class:"action-form__placeholder"},"Email",-1)),de={class:"action-form__element"},me={class:"action-form__input-body"},fe=_(()=>e("div",{class:"action-form__placeholder"},"Пароль",-1)),pe={class:"action-form__input-wrapper"},ve={__name:"LoginView",setup(u){const{fetchUserCartProducts:L}=q(),C=E();M({validateOnBlur:!0,validateOnChange:!0,validateOnInput:!0,validateOnModelUpdate:!0});const{isErr:f,loginSchema:I,toggleBlur:g,toggleFocus:h,invalidSubmit:T,isInvalidForm:x}=J(),y=l(!0);setTimeout(()=>y.value=!1,2500);const p=l(!1),v=l(!1),d=l(!1),S=l("Произошла ошибка"),V=async n=>{d.value=!0;let s=await D("/api/login",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(n)});console.log(s),s.err?(console.log(s.err),S.value=s.err.message||s.err.sqlMessage,f.value=!0,setTimeout(()=>f.value=!1,3e3)):s.noSuchUser?(p.value=!0,setTimeout(()=>p.value=!1,3e3)):s.token&&(P().addUserToStorage(s),v.value=!0,await L(),setTimeout(()=>{C.push("/"),v.value=!1},2e3)),d.value=!1},N=n=>{const s=n.target.closest(".action-form__element").querySelector("input");console.log(s),s.type==="password"?s.type="text":s.type="password"};return(n,s)=>{const b=w("LoadingGif"),O=w("RouterLink");return a(),i("div",W,[t(m,{name:"message"},{default:r(()=>[p.value?(a(),i("div",H,Q)):c("",!0)]),_:1}),t(m,{name:"message"},{default:r(()=>[v.value?(a(),i("div",X,Z)):c("",!0)]),_:1}),t(m,{name:"message"},{default:r(()=>[o(f)?(a(),i("div",ee,[e("div",se,k(S.value),1)])):c("",!0)]),_:1}),t(m,{name:"message"},{default:r(()=>[n.$route.query.isLoginRequired&&y.value?(a(),i("div",oe,[e("div",te," Для доступа к данной странице ("+k(n.$route.query.redirect)+") необходимо авторизироваться ! ",1)])):c("",!0)]),_:1}),e("div",ae,[e("div",ne,[e("div",ie,[t(o(R),{onSubmit:V,onInvalidSubmit:o(T),"validation-schema":o(I)},{default:r(()=>[re,e("div",ce,[e("div",le,[e("div",_e,[ue,t(o(F),{class:"action-form__input",type:"text",name:"email",onFocus:o(h),onBlur:o(g)},null,8,["onFocus","onBlur"])]),t(o(B),{class:"action-form__error-msg",name:"email"})]),e("div",de,[e("div",me,[fe,t(o(F),{class:"action-form__input",type:"password",name:"password",onFocus:o(h),onBlur:o(g)},null,8,["onFocus","onBlur"])]),e("div",{class:"action-form__show-pass",onClick:N}," Показать/скрыть пароль "),t(o(B),{class:"action-form__error-msg",name:"password"})]),e("div",pe,[d.value?c("",!0):(a(),i("button",{key:0,class:j(["action-form__btn",{err:o(x)}]),type:"submit"}," Войти ",2))])])]),_:1},8,["onInvalidSubmit","validation-schema"]),d.value?(a(),A(b,{key:0})):c("",!0)]),t(O,{class:"home-button",to:"/"},{default:r(()=>[z("На главную")]),_:1})])])])}}},ye=U(ve,[["__scopeId","data-v-80099f2a"]]);export{ye as default};

import{_ as F,o as t,c as i,e as s,t as I,R as B,V as N,r,a as O,L as q,b as x,g as m,d,w as f,T,n as V,i as _,B as G,C as P,f as p,F as z,j as J,E as H,p as K,l as Q}from"./index-e8cd63f0.js";const W={class:"review"},X={class:"review__body"},Y={class:"review__header"},Z={class:"review__user"},ee={class:"review__date"},se={class:"review__text"},te={__name:"ReviewItem",props:{review:{type:Object,required:!0}},setup(e){const a=e;return(n,c)=>(t(),i("div",W,[s("div",X,[s("div",Y,[s("div",Z,I(e.review.name),1),s("div",ee,I(new Date(a.review.date).toLocaleDateString()),1)]),s("div",se,I(e.review.text),1)])]))}},ae=F(te,[["__scopeId","data-v-2e0b29d7"]]),j="https://sushi-backend-henna.vercel.app",oe=async()=>{let e=await fetch(`${j}/api/reviews`);if(!e.ok)throw new Error((await e.json()).err);return await e.json()},re=async e=>{let a=await fetch(`${j}/api/reviews`,{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw new Error((await a.json()).err);return await a.json()},ie=e=>{const a=e.split(",")[0].split(".");return a[1]+"."+a[0]+"."+a[2]};const A=e=>(K("data-v-6d16840c"),e=e(),Q(),e),ne={class:"reviews"},le={key:1,class:"reviews__body"},_e={key:0,class:"reviews__message reviews__message_added"},de={key:0,class:"reviews__message reviews__message_not-logged"},ce={key:0,class:"reviews__header"},ve=A(()=>s("div",{class:"reviews__title"},"Отзывы",-1)),ue={class:"reviews__button"},me={class:"reviews__add-form review-form"},we={class:"review-form__elements"},ge={class:"review-form__element"},he=A(()=>s("div",{class:"review-form__element-title"},"Ваше сообщение",-1)),fe={class:"review-form__textarea"},pe={class:"review-form__submit"},ye=["disabled"],be={key:2,class:"reviews__reviews"},ke={class:"reviews__all-reviews"},Se={key:3,class:"reviews__no-reviews"},Re={__name:"ReviewsView",setup(e){const a=B({message:N().min(10,"Сообщение должно иметь больше символов!").required("Поле обязательное для ввода!")}),n=r(!1),c=r(!1),C=async(o,{resetForm:l})=>{if(y.checkIfUserLogged){let h=new Date().toLocaleString();await U({...o,currentDate:h}),l()}else k.value=!0,setTimeout(()=>k.value=!1,2500)},D=()=>{c.value=!0,setTimeout(()=>c.value=!1,500)},y=O(),v=r([]),b=r(!1),w=r(!1),k=r(!1),S=r(!1),R=r(!1),g=r(!1),E=r("Произошла ошибка"),$=r("Произошла ошибка"),U=async o=>{try{g.value=!0,o.user_id=y.currentUser.id,await re(o),v.value.push({text:o.message,date:ie(o.currentDate),name:y.currentUser.name}),S.value=!0,setTimeout(()=>S.value=!1,2500)}catch(l){R.value=!0,setTimeout(()=>R.value=!1,2500),$.value=l.message}finally{g.value=!1}};return q(async()=>{try{b.value=!0;const o=await oe();v.value=o}catch(o){w.value=!0,E.value=o.message}finally{b.value=!1}}),(o,l)=>{const h=x("LoadingGif"),L=x("VErrorMessage"),M=x("slide-up-down");return t(),i("div",ne,[b.value?(t(),m(h,{key:0})):(t(),i("div",le,[d(T,{name:"message"},{default:f(()=>[S.value?(t(),i("div",_e," Отзыв добавлен! ")):_("",!0)]),_:1}),d(T,{name:"message"},{default:f(()=>[k.value?(t(),i("div",de," Для добавления отзыва требуется войти в аккаунт! ")):_("",!0)]),_:1}),w.value?_("",!0):(t(),i("div",ce,[ve,s("div",ue,[s("button",{class:V(["reviews__add-button",{red:n.value,"icon-plus":!n.value}]),onClick:l[0]||(l[0]=u=>n.value=!n.value)}," Добавить отзыв ",2)])])),d(M,{modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=u=>n.value=u),duration:500},{default:f(()=>[s("div",me,[g.value?(t(),m(h,{key:0,class:"reviews__loading-add"})):_("",!0),d(p(z),{onInvalidSubmit:D,onSubmit:C,class:V(["review-form__form",{opacity:g.value}]),"validation-schema":p(a)},{default:f(()=>[s("div",we,[s("div",ge,[he,s("div",fe,[d(p(J),{as:"textarea",name:"message",placeholder:"Сообщение"})]),d(p(H),{class:"review-form__error-msg",name:"message"})]),s("div",pe,[s("button",{type:"submit",class:V({err:c.value}),disabled:c.value}," Отправить отзыв ",10,ye)])])]),_:1},8,["validation-schema","class"]),R.value?(t(),m(L,{key:1,"err-message":$.value,style:{"margin-bottom":"20px"}},null,8,["err-message"])):_("",!0)])]),_:1},8,["modelValue"]),w.value?(t(),m(L,{key:1,"err-message":E.value},null,8,["err-message"])):_("",!0),v.value.length?(t(),i("div",be,[s("div",ke,[(t(!0),i(G,null,P(v.value,u=>(t(),m(ae,{key:u.review_id,review:u},null,8,["review"]))),128))])])):!w.value&&!v.value.length?(t(),i("div",Se," Пока что отзывов нет, станьте первым! ")):_("",!0)]))])}}},xe=F(Re,[["__scopeId","data-v-6d16840c"]]);export{xe as default};
